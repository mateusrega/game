<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CatTroll</title>

<style>
:root {
  --bg: #1e1e1e;
  --panel: #2a2a2a;
  --grid: #111;
  --platform: #6a3;
  --goal: #f55;
  --player: #ff0;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  color: #eee;
  font-family: monospace;
  overflow: hidden;
}

.screen {
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  background: var(--panel);
  padding: 6px;
  text-align: center;
  font-weight: bold;
}

.toolbar {
  display: flex;
  gap: 6px;
  justify-content: center;
  padding: 6px;
}

button {
  background: #444;
  color: #fff;
  border: none;
  padding: 6px 12px;
  cursor: pointer;
  border-radius: 6px;
}

button:hover {
  background: #666;
}

#grid {
  display: grid;
  gap: 1px;
  background: var(--grid);
  border: 2px solid #555;
  margin: auto;
}

.tile {
  width: 16px;
  height: 16px;
  background: #444;
  cursor: pointer;
}

.tile.platform { background: var(--platform); }
.tile.goal { background: var(--goal); }

canvas {
  margin: auto;
  border: 2px solid #555;
  background: #000;
  image-rendering: pixelated;
}

.hint {
  text-align: center;
  font-size: 12px;
  opacity: 0.8;
  padding-bottom: 6px;
}
</style>
</head>

<body>

<!-- EDITOR -->
<div id="editor" class="screen">
  <header>üê± CatTroll ‚Äî Editor de Fases</header>

  <div class="toolbar">
    <button onclick="modo='plataforma'">Plataforma</button>
    <button onclick="modo='goal'">Chegada</button>
    <button onclick="iniciarJogo()">‚ñ∂ Testar</button>
  </div>

  <div id="grid"></div>

  <div class="hint">Clique e arraste para desenhar</div>
</div>

<!-- JOGO -->
<div id="jogo" class="screen" hidden>
  <header>üéÆ CatTroll ‚Äî Jogo</header>
  <canvas id="canvas"></canvas>
  <div class="hint">‚Üê ‚Üí mover | ‚Üë pular</div>
  <button onclick="voltarEditor()">‚èÆ Voltar ao editor</button>
</div>

<script>
/* ===== CONFIG ===== */
const TILE = 16;
const COLS = Math.floor((window.innerWidth * 0.9) / TILE);
const ROWS = Math.floor((window.innerHeight * 0.6) / TILE);

/* ===== MAPA ===== */
let map = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
let modo = 'plataforma';
let pintando = false;

const grid = document.getElementById("grid");

/* ===== GRID ===== */
function criarGrid() {
  grid.innerHTML = "";
  grid.style.gridTemplateColumns = `repeat(${COLS}, ${TILE}px)`;

  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {
      const t = document.createElement("div");
      t.className = "tile";
      if (map[y][x] === 1) t.classList.add("platform");
      if (map[y][x] === 2) t.classList.add("goal");

      t.onmousedown = () => { pintar(x, y); pintando = true; };
      t.onmouseover = () => pintando && pintar(x, y);
      grid.appendChild(t);
    }
  }
}

function pintar(x, y) {
  if (modo === "plataforma") map[y][x] = 1;
  if (modo === "goal") {
    map.flat().forEach((_, i) => {
      const yy = Math.floor(i / COLS);
      const xx = i % COLS;
      if (map[yy][xx] === 2) map[yy][xx] = 0;
    });
    map[y][x] = 2;
  }
  criarGrid();
}

window.onmouseup = () => pintando = false;
criarGrid();

/* ===== JOGO ===== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = COLS * TILE;
canvas.height = ROWS * TILE;

const player = {
  x: 32,
  y: 0,
  w: 14,
  h: 14,
  vx: 0,
  vy: 0,
  speed: 1.6,
  jump: 5,
  onGround: false
};

const gravity = 0.25;
const keys = {};
let playing = false;

/* ===== COLIS√ÉO ===== */
function solidAt(px, py) {
  const x = Math.floor(px / TILE);
  const y = Math.floor(py / TILE);
  return map[y]?.[x] === 1;
}

function update() {
  // Horizontal
  player.vx = 0;
  if (keys.ArrowLeft) player.vx = -player.speed;
  if (keys.ArrowRight) player.vx = player.speed;

  let nx = player.x + player.vx;
  if (!solidAt(nx, player.y) && !solidAt(nx + player.w, player.y + player.h))
    player.x = nx;

  // Vertical
  player.vy += gravity;
  let ny = player.y + player.vy;

  if (solidAt(player.x, ny + player.h)) {
    player.vy = 0;
    player.onGround = true;
  } else {
    player.y = ny;
    player.onGround = false;
  }

  // Vit√≥ria
  const cx = Math.floor((player.x + player.w / 2) / TILE);
  const cy = Math.floor((player.y + player.h / 2) / TILE);
  if (map[cy]?.[cx] === 2) {
    alert("üéâ Voc√™ venceu!");
    voltarEditor();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let y = 0; y < ROWS; y++)
    for (let x = 0; x < COLS; x++) {
      if (map[y][x] === 1) {
        ctx.fillStyle = "#6a3";
        ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
      }
      if (map[y][x] === 2) {
        ctx.fillStyle = "#f55";
        ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
      }
    }

  ctx.fillStyle = "#ff0";
  ctx.fillRect(player.x, player.y, player.w, player.h);
}

function loop() {
  if (!playing) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

/* ===== TELA ===== */
function iniciarJogo() {
  document.getElementById("editor").hidden = true;
  document.getElementById("jogo").hidden = false;
  playing = true;

  player.x = 32;
  player.y = 0;
  player.vy = 0;

  loop();
}

function voltarEditor() {
  playing = false;
  document.getElementById("jogo").hidden = true;
  document.getElementById("editor").hidden = false;
}

/* ===== INPUT ===== */
window.onkeydown = e => {
  keys[e.code] = true;
  if (e.code === "ArrowUp" && player.onGround) {
    player.vy = -player.jump;
    player.onGround = false;
  }
};
window.onkeyup = e => keys[e.code] = false;
</script>
</html>
